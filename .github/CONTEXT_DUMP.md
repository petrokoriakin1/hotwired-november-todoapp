# Context Dump - November 27, 2025

## Project Overview
**Repository:** hotwired-november-todoapp  
**Owner:** petrokoriakin1  
**Current Branch:** main  
**Live URL:** https://hotwired-november-todoapp.fly.dev/

### Tech Stack
- **Framework:** Rails 8
- **Ruby Version:** 3.4.7
- **Frontend:** Hotwired (Turbo + Stimulus)
- **CSS:** Tailwind CSS v4.1.16
- **JavaScript Loading:** Importmap (no build pipeline)
- **Database:** SQLite3 (development)
- **Deployment:** Fly.io

## Issue Resolution Summary

### Original Problem
Missing assets in development environment causing broken UI on localhost:3000

### Root Cause
Recent commit removed `vendor/javascript` from git tracking (correctly, as it's generated by importmap), but the asset pipeline manifest was trying to link to it as a static directory, which doesn't exist in the CI environment.

### Solution Implemented
1. **Initial Attempt (Incorrect):** Added `//= link_tree ../../../vendor/javascript .js` back to manifest
   - This caused CI to fail because directory doesn't exist in CI environment
   - Result: `Sprockets::ArgumentError: link_tree argument must be a directory`

2. **Final Solution (Correct):** Removed the vendor/javascript link entirely
   - Importmap handles vendor asset serving dynamically at runtime
   - Local JavaScript files are still linked via `//= link_tree ../../javascript .js`
   - Result: ✅ Assets precompile successfully in both dev and CI

### Files Modified
```
app/assets/config/manifest.js
├── Removed: //= link_tree ../../../vendor/javascript .js
├── Kept: //= link_tree ../images
├── Kept: //= link_directory ../stylesheets .css
├── Kept: //= link_tree ../../javascript .js
└── Kept: //= link_tree ../builds
```

### Documentation Updates
```
README.md
└── Enhanced with:
    ├── Better dev setup instructions (bin/dev)
    ├── Development section documenting asset pipeline
    ├── Testing and Docker instructions
    └── Link to ASSET_PIPELINE_FIX.md

.github/ASSET_PIPELINE_FIX.md
└── Detailed technical documentation of the fix
```

## Build Status

### Local CI Checks (All Passing ✅)
```
✅ RuboCop: 59 files inspected, 0 offenses
✅ RSpec: 36 examples, 0 failures
✅ Assets Precompile: Tailwind CSS compiled successfully
✅ Docker Build: Image builds without errors
✅ Rails Server: Running on localhost:3000 with assets loading
```

### Asset Pipeline Architecture
```
CSS:
  ├── Tailwind CSS (compiled via tailwindcss:watch)
  └── Located: app/assets/builds/tailwind.css

JavaScript:
  ├── Local: app/javascript/
  │   ├── application.js
  │   └── controllers/
  ├── Vendor (via Importmap):
  │   ├── @hotwired/turbo-rails
  │   ├── @hotwired/stimulus
  │   └── @hotwired/stimulus-loading
  └── Served: Dynamically at runtime
```

## Recent Commits
```
cfa6c21 - Remove vendor/javascript link from manifest - importmap handles dynamically
4fbdd4c - Rename progress file to ASSET_PIPELINE_FIX and update README with dev docs
1b75447 - Add progress report
755ce3f - Remove temporary download script
0737643 - Restore vendor/javascript link to manifest.js
eeeb206 - revert perplexity
```

## Development Setup

### Quick Start
```bash
bundle install
bin/rails db:create db:migrate db:seed
bin/dev  # Starts Rails server + Tailwind watcher
```

### Alternative (with overmind)
```bash
overmind start
```

### Port Configuration
- **Rails Server:** localhost:3000
- **Asset Pipeline:** Handled by Rails asset serving
- **CSS Watcher:** bin/rails tailwindcss:watch (auto-compiled)

## Testing & CI Pipeline

### Local Testing
```bash
# Run all tests
bundle exec rspec

# Lint code
bundle exec rubocop --parallel

# Precompile assets
bin/rails assets:precompile

# Test Docker build
docker build --tag hotwired-november-todoapp .
```

### CI Workflow (.github/workflows/ci.yml)
1. Setup Ruby 3.4.7
2. Bundle dependencies
3. Precompile assets
4. Validate Dockerfile
5. Run RuboCop
6. Run strong_versions
7. Prepare database
8. Run RSpec

## Known Details

### .gitignore Considerations
```
/vendor/bundle/      # Gems (bundler)
/vendor/             # Ignored (line 3)
/app/assets/builds/* # Built assets
hotwired_*_*         # SQLite databases
```

Note: `vendor/javascript/` is properly gitignored. Importmap dynamically populates it when needed.

### Procfile
```
web: env RUBY_DEBUG_OPEN=true bin/rails server -p 3000
css: bin/rails tailwindcss:watch
```

### Dockerfile
- Multi-stage build (base → build → final)
- Ruby 3.4.7 slim image
- Production-ready with asset precompilation
- Non-root user (rails) for security
- Port: 3000

## Current Status
✅ **Build: GREEN**  
✅ **Development Environment: Working**  
✅ **Assets: Serving Correctly**  
✅ **Tests: All Passing**  
✅ **Documentation: Updated**

## Next Actions (If Needed)
- Monitor CI pipeline for any failures
- Verify Fly.io deployment picks up the changes
- Consider documenting Importmap configuration in docs/
